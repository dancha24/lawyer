{% extends 'control.html' %}
{% load static %}
{% load i18n admin_urls static admin_list %}
{% block content %}
    {% load mathfilters %}

    <div class="row small-spacing">
        <a class="margin-bottom-10 btn btn-xs btn-success waves-effect waves-light"
           href="{% url 'report_nagrada_ispolnitel_data' %}"><i class="fa fa-edit"></i> Изменить</a>
        <div class="col-xs-12">
            <p>{{ all_sum }} руб. - Общая сумма вознаграждений</p>
            <p>{{ count_spe }} - Кол-во вознаграждений</p>
            <p>{{ count_per }} - Кол-во исполнителей</p>
            <h2 class="padding-10">Дела</h2>

            <table id="example" class="table table-striped table-bordered display" style="width:100%">
                <thead>
                <tr>
                    <th colspan="3">Инфо по вознаграждению</th>
                    <th colspan="5">Инфо по делу</th>
                </tr>
                <tr>
                    <th>Сумма</th>
                    <th>Оплачено</th>
                    <th>Остаток</th>
                    <th>Дело</th>
                    <th>Коментарий</th>
                    <th>Сумма</th>
                    <th>Оплачено</th>
                    <th>Долг</th>
                </tr>
                </thead>
                <tbody id="accordion" class="js__ui_accordion">
                {% for deal in extra_perf_deals %}
                    <tr class="accordion-content">
                        <td style="vertical-align: middle">{{ deal.sum }}</td>
                        <td style="vertical-align: middle">{{ deal.payment }}</td>
                        <td style="vertical-align: middle">{{ deal.payment|sub:deal.payment }}</td>
                        <td style="vertical-align: middle">
                            <a href="{% url 'affairs_info' affair_id=deal.affairs.id %}">{{ deal.affairs }}</a>
                        </td>
                        <td style="vertical-align: middle">
                            {{ deal.affairs.deal_status }} - {{ deal.affairs.prise_status }}
                        </td>
                        <td style="vertical-align: middle">
                            {{ deal.affairs.prise }}
                        </td>
                        <td style="vertical-align: middle">
                            {{ deal.affairs.all_rec_sum }}
                        </td>
                        <td style="vertical-align: middle">
                            {{ deal.affairs.prise|sub:deal.affairs.all_rec_sum }}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            <h2 class="padding-10">Допники</h2>
            <table id="example" class="table table-striped table-bordered display" style="width:100%">
                <thead>
                <tr>
                    <th colspan="3">Инфо по вознаграждению</th>
                    <th colspan="4">Инфо по допнику</th>
                </tr>
                <tr>
                    <th>Сумма</th>
                    <th>Оплачено</th>
                    <th>Остаток</th>
                    <th>Допник</th>
                    <th>Сумма</th>
                    <th>Оплачено</th>
                    <th>Долг</th>
                </tr>
                </thead>
                <tbody>
                {% for deal in extra_perf_deals %}
                    <tr>
                        <td style="vertical-align: middle">{{ deal.sum }}</td>
                        <td style="vertical-align: middle">{{ deal.payment }}</td>
                        <td style="vertical-align: middle">{{ deal.payment|sub:deal.payment }}</td>
                        <td style="vertical-align: middle">
                            <a href="{% url 'affairs_info' affair_id=deal.affairs.id %}">{{ deal.affairs }}</a>
                        </td>
                        <td style="vertical-align: middle">
                            {{ deal.extraaffairs.sum }}
                        </td>
                        <td style="vertical-align: middle">
                            {#                            {{ deal.extraaffairs.ex_prise_already }}#}
                        </td>
                        <td style="vertical-align: middle">
                            {#                            {{ deal.extraaffairs.sum|sub:deal.extraaffairs.ex_prise_already }}#}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            <!-- /.box-content -->
        </div>
    </div>
    <!-- /.row small-spacing -->
{% endblock %}
{% block modal %}
    <div class="modal fade" id="filters" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel-2">Фильтры</h4>
                </div>
                <form method="post">
                    {% csrf_token %}
                    <div class="modal-body">
                        {{ form.as_p }}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default btn-sm waves-effect waves-light"
                                data-dismiss="modal">Закрыть
                        </button>
                        <button type="submit" name="filter" class="btn btn-primary btn-sm waves-effect waves-light">
                            Сохранить
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}